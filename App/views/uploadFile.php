<?php
// +-----------------------------------------------
// | @author Carlos M. Gómez
// | @date Miércoles 5 de diciembre de 2012
// | @Version 1.0
// +-----------------------------------------------
// +---------------------------Comentarios de versión
namespace App\views;
defined("APPPATH") OR die("Access denied");

use \Core\Database;
use \App\Models\ServiceOrders\SOAttachment		as SOAt;

/*******************************************************************************
*                                                                              *
*                           ##########REQUEST##########                        *
*                                                                              *
*******************************************************************************/
if (isset($_FILES['ofd_SOAttachment_h'])) {
		$currentSO = $_POST['SOactual'];
		
		if(!is_dir("../App/web/media/upload/files/$currentSO/"))  mkdir("../App/web/media/upload/files/$currentSO/", 0777);
		
		$archivoTipo = $_POST['tipo_archivo'];
		$archivo = $_FILES['ofd_SOAttachment_h'];
		$extension = pathinfo($archivo['name'], PATHINFO_EXTENSION);
		$time = time();
		
		$nombre = $archivoTipo . "_{$_POST['nombre_archivo']}_$time.$extension";
		
		if (move_uploaded_file($archivo['tmp_name'], "../App/web/media/upload/files/$currentSO/$nombre")) {
			$soat=new SOAt();
			$nextpkSoat=$soat->getNextId("pkSOrderAttachment","sorderattachment");
			$soat->setPKSOAttach($nextpkSoat);
			$soat->setFKSorder($currentSO);
			$soat->setSOAttachLink($nombre);
			$soat->setSOAttachType($_POST['tipo_archivo']);
			$soat->insertData('sorderattachment');
			
			
			echo 1;
		} else {
			echo 0;
		}
	}
/*******************************************************************************
*                                                                              *
*                        ##########CONSTANTES##########                        *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                         ##########ATRIBUTOS##########                        *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                       ##########PROPIEDADES##########                        *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                  ##########MÉTODOS ABSTRACTOS##########                      *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                  ######CONSTRUCTORES Y DESTRUCTORES####                      *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                  ##########MÉTODOS MÁGICOS##########                         *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                  ##########MÉTODOS PÚBLICOS##########                        *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                  ##########MÉTODOS PRIVADOS##########                        *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                  ##########EVENTOS##########                                 *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                  ##########CONTROLES##########                               *
*                                                                              *
*******************************************************************************/
/*******************************************************************************
*                                                                              *
*                  ##########MAIN##########                                    *
*                                                                              *
*******************************************************************************/
?>
